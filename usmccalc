Private Sub Worksheet_Change(ByVal Target As Range)
    Dim rng As Range
    Set rng = Intersect(Target, Range("H:V")) ' check if changed cell is within columns N to V
    If Not rng Is Nothing Then ' if changed cell is within columns N to V
        Application.EnableEvents = False ' disable events to prevent infinite loop
        ' loop through rows in column F until first blank cell
        Dim i As Integer
        i = 9 ' start from row 9
        Do While Not IsEmpty(Range("F" & i))
            CalculatePFT i ' pass the row number to the CalculatePFT subroutine
            i = i + 1 ' increment the row number
        Loop
        Application.EnableEvents = True ' re-enable events
    End If
End Sub

Sub CalculatePFT(rowNum As Integer)
    Dim age As Integer
    Dim gender As String
    Dim enteredAge As Integer
    Dim pullups As Integer
    Dim pushups As Integer
    Dim plank As Integer
    Dim runtime As Integer
    Dim rowtime As Integer
    Dim i As Integer
    Dim mtctime As Integer
    Dim muftime As Integer

    'Age Calculations --> Entered --> Numeric --> Underage --> Round to 51 but display actual
    enteredAge = Range("H" & rowNum).Value
    If IsNumeric(enteredAge) And Int(enteredAge) = enteredAge Then
        If enteredAge < 17 Then 'if age is below 17, exit the subroutine
            MsgBox "Age must be 17 or above."
            Exit Sub
        ElseIf enteredAge > 51 Then 'if age is above 51, set age to 51 for calculations
            age = 51
        Else 'otherwise, use entered age for calculations
            age = enteredAge
        End If
        age = Round(age, 0)
        Range("H" & rowNum).Value = enteredAge 'display the entered age to the user
    End If


    'Gender determination in I regardless of case
    gender = LCase(Range("I" & rowNum).Value)
    
    'Ensure all time entries are formatted correctly
    rowtime = Range("R" & rowNum).Value 'ROW
        ' Round up the input value to the nearest hundred if the tens digit is 6 or greater
        If (rowtime Mod 100) >= 60 Then
            rowtime = Int((rowtime + 99) / 100) * 100
            Range("R" & rowNum).Value = rowtime
        End If
    rowtime = rowtime

    runtime = Range("Q" & rowNum).Value 'RUN
        ' Round up the input value to the nearest hundred if the tens digit is 6 or greater
        If (runtime Mod 100) >= 60 Then
            runtime = Int((runtime + 99) / 100) * 100
            Range("Q" & rowNum).Value = runtime
        End If
    runtime = runtime

    mtctime = Range("T" & rowNum).Value 'MTC
        ' Round up the input value to the nearest hundred if the tens digit is 6 or greater
        If (mtctime Mod 100) >= 60 Then
            mtctime = Int((mtctime + 99) / 100) * 100
            Range("T" & rowNum).Value = mtctime
        End If
    mtctime = mtctime

    muftime = Range("V" & rowNum).Value 'MUF
        ' Round up the input value to the nearest hundred if the tens digit is 6 or greater
        If (muftime Mod 100) >= 60 Then
            muftime = Int((muftime + 99) / 100) * 100
            Range("V" & rowNum).Value = muftime
        End If
    muftime = muftime




'Pullups / Pushups
If Len(Range("O" & rowNum).Value) = 0 Then
' Check if gender is "M", age in H9 is numeric and pullups in N9 is numeric
    Range("Z" & rowNum).ClearContents
    If gender = "m" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("N" & rowNum).Value) Then
    
        pullups = Range("N" & rowNum).Value ' Get the value of pullups from cell N9
            
        If pullups < 3 Then 'if pullups are less than 3, score is 0
            score = 0
        ElseIf pullups > 23 Then 'if pullups are more than 23, score is 100
            score = 100
        Else 'otherwise, use lookup table to find the score
            ' Find the score based on the values of age and pullups in worksheet m_pull
            score = Application.WorksheetFunction.VLookup(pullups, Worksheets("m_pull").Range("A2:AJ25"), _
                Application.WorksheetFunction.Match(CLng(age), Worksheets("m_pull").Range("B1:AJ1"), 0), False)
        End If
        
    ' Check if gender is "f", age in H9 is numeric and pullups in N9 is numeric
    ElseIf gender = "f" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("N" & rowNum).Value) Then

        pullups = Range("N" & rowNum).Value ' Get the value of pullups from cell N9
            
        If pullups < 2 Then 'if pullups are less than 2, score is 0
            score = 0
        ElseIf pullups > 12 Then 'if pullups are more than 12, score is 100
            score = 100
        Else 'otherwise, use lookup table to find the score
            ' Find the score based on the values of age and pullups in worksheet f_pull
            score = Application.WorksheetFunction.VLookup(pullups, Worksheets("f_pull").Range("A2:AJ14"), _
                Application.WorksheetFunction.Match(CLng(age), Worksheets("f_pull").Range("B1:AJ1"), 0), False)
        End If
        
    End If
    ' Display the score in cell AA1
    Range("Y" & rowNum).Value = score
Else
' Code to execute if A1 is not empty
    Range("Y" & rowNum).ClearContents
    If gender = "m" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("O" & rowNum).Value) Then

        pushups = Range("O" & rowNum).Value ' Get the value of pullups from cell N9
            
        If pushups < 19 Then 'if pullups are less than 3, score is 0
            score = 0
        ElseIf pushups > 87 Then 'if pullups are more than 23, score is 100
            score = 70
        Else 'otherwise, use lookup table to find the score
            ' Find the score based on the values of age and pullups in worksheet m_pull
            score = Application.WorksheetFunction.VLookup(pushups, Worksheets("m_push").Range("A2:AJ73"), _
                Application.WorksheetFunction.Match(CLng(age), Worksheets("m_push").Range("B1:AJ1"), 0), False)
        End If
        
    ' Check if gender is "f", age in H9 is numeric and pullups in N9 is numeric
    ElseIf gender = "f" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("O" & rowNum).Value) Then

        pushups = Range("O" & rowNum).Value ' Get the value of pullups from cell N9
            
        If pushups < 9 Then 'if pullups are less than 2, score is 0
            score = 0
        ElseIf pushups > 51 Then 'if pullups are more than 12, score is 100
            score = 70
        Else 'otherwise, use lookup table to find the score
            ' Find the score based on the values of age and pullups in worksheet f_pull
            score = Application.WorksheetFunction.VLookup(pushups, Worksheets("f_push").Range("A2:AJ43"), _
                Application.WorksheetFunction.Match(CLng(age), Worksheets("f_push").Range("B1:AJ1"), 0), False)
        End If
        
    End If
    ' Display the score in cell AA1
    Range("Z" & rowNum).Value = score
End If

'Plank time
If Len(Range("P" & rowNum).Value) > 0 Then
            Dim lookupValue As Integer
            Dim result As Integer
            lookupValue = Range("P" & rowNum).Value

            ' Round up the input value to the nearest hundred if the tens digit is 6 or greater
            If (lookupValue Mod 100) >= 60 Then
                lookupValue = Int((lookupValue + 99) / 100) * 100
                Range("P" & rowNum).Value = lookupValue
            End If

            If lookupValue > 345 Then
                result = 100
                Range("AA" & rowNum).Value = result
            ElseIf lookupValue < 109 Then
                result = 0
                Range("AA" & rowNum).Value = result
            Else
                result = Application.VLookup(lookupValue, Sheets("plank").Range("A9:B168"), 2, False)
                Range("AA" & rowNum).Value = result
            End If
        Else
            Range("AA" & rowNum).ClearContents
        End If


'Run time and Row Time
If Range("D4").Value = "NO" Then 'Check D4 for  NO
    If Len(Range("R" & rowNum).Value) = 0 Then
        ' Check if gender is "M", age in H9 is numeric and run in Q9 is numeric
        Range("AC" & rowNum).ClearContents

            If gender = "m" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("Q" & rowNum).Value) Then

                
                If runtime < 1800 Then 'if runtime is less than 1800, the score is 100
                    runscore = 100
                ElseIf runtime > 3300 Then 'if runtime is greater than 3300, the score is 0
                    runscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and runtime in worksheet m_run_noalt
                    runscore = Application.WorksheetFunction.VLookup(runtime, Worksheets("m_run_noalt").Range("A2:AJ894"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("m_run_noalt").Range("B1:AJ1"), 0), False)
                End If
                
            ' Check if gender is "f", age in H9 is numeric and runtime in Q9 is numeric
            ElseIf gender = "f" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("Q" & rowNum).Value) Then

                   
                If runtime < 2100 Then 'if runtime is less than 2100, the score is 100
                    runscore = 100
                ElseIf runtime > 3600 Then 'if runtime is greater than 3600, the score is 0
                    runscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and runtime in worksheet f_run_noalt
                    runscore = Application.WorksheetFunction.VLookup(runtime, Worksheets("f_run_noalt").Range("A2:AJ913"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("f_run_noalt").Range("B1:AJ1"), 0), False)
                End If
                
            End If
            ' Display the score in cell AB
            Range("AB" & rowNum).Value = runscore
    Else

        ' Code to execute if A1 is not empty
            Range("AB" & rowNum).ClearContents
            If gender = "m" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("R" & rowNum).Value) Then

                    
                If rowtime < 1800 Then 'if rowtotal is less than 1800, the score is 100
                    rowscore = 100
                ElseIf rowtime > 2600 Then 'if rowtotal is greater than 2600, the score is 0
                    rowscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and pullups in worksheet m_pull
                    rowscore = Application.WorksheetFunction.VLookup(rowtime, Worksheets("m_row_noalt").Range("A2:AJ482"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("m_row_noalt").Range("B1:AJ1"), 0), False)
                End If
                
            ' Check if gender is "f", age in H9 is numeric and rowtime in R9 is numeric
            ElseIf gender = "f" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("R" & rowNum).Value) Then
                   
                If rowtime < 2100 Then 'if rowtotal is less than 2100, the score is 100
                    rowscore = 100
                ElseIf rowtime > 2900 Then 'if rowtotal is greater than 2900, the score is 0
                    rowscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and pullups in worksheet f_pull
                    rowscore = Application.WorksheetFunction.VLookup(rowtime, Worksheets("f_row_noalt").Range("A2:AJ913"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("f_row_noalt").Range("B1:AJ1"), 0), False)
                End If
                
            End If
            ' Display the score in cell AC
            Range("AC" & rowNum).Value = rowscore
    End If
ElseIf Range("D4").Value = "YES" Then ' Altitude Code for Row/Run
    If Len(Range("R" & rowNum).Value) = 0 Then
        ' Check if gender is "M", age in H9 is numeric and run in Q9 is numeric
        Range("AC" & rowNum).ClearContents
    
        If gender = "m" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("Q" & rowNum).Value) Then

                    
            If runtime < 1930 Then 'if runtime is less than 1930, the score is 100
                runscore = 100
            ElseIf runtime > 3430 Then 'if runtime is greater than 3430, the score is 0
                runscore = 0
            Else 'otherwise, use lookup table to find the score
                ' Find the score based on the values of age and runtime in worksheet m_run_alt
                runscore = Application.WorksheetFunction.VLookup(runtime, Worksheets("m_run_alt").Range("A2:AJ908"), _
                            Application.WorksheetFunction.Match(CLng(age), Worksheets("m_run_alt").Range("B1:AJ1"), 0), False)
            End If
                
            ' Check if gender is "f", age in H9 is numeric and runtime in Q9 is numeric
        ElseIf gender = "f" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("Q" & rowNum).Value) Then

                    
            If runtime < 2230 Then 'if runtime is less than 2230, the score is 100
                runscore = 100
            ElseIf runtime > 3730 Then 'if runtime is greater than 3730, the score is 0
                runscore = 0
            Else 'otherwise, use lookup table to find the score
                 ' Find the score based on the values of age and runtime in worksheet f_run_noalt
                runscore = Application.WorksheetFunction.VLookup(runtime, Worksheets("f_run_alt").Range("A2:AJ909"), _
                          Application.WorksheetFunction.Match(CLng(age), Worksheets("f_run_alt").Range("B1:AJ1"), 0), False)
            End If
        End If
            ' Display the score in cell AC
            Range("AB" & rowNum).Value = runscore
    Else

        ' Code to execute if A1 is not empty
            Range("AB" & rowNum).ClearContents
            If gender = "m" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("R" & rowNum).Value) Then

                    
                If rowtime < 1840 Then 'if rowtotal is less than 1840, the score is 100
                    rowscore = 100
                ElseIf rowtime > 2640 Then 'if rowtotal is greater than 2640, the score is 0
                    rowscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and pullups in worksheet m_pull
                    rowscore = Application.WorksheetFunction.VLookup(rowtime, Worksheets("m_row_alt").Range("A2:AJ483"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("m_row_alt").Range("B1:AJ1"), 0), False)
                End If
                
            ' Check if gender is "f", age in H9 is numeric and rowtime in R9 is numeric
            ElseIf gender = "f" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("R" & rowNum).Value) Then

                   
                If rowtime < 2140 Then 'if rowtotal is less than 2140, the score is 100
                    rowscore = 100
                ElseIf rowtime > 2940 Then 'if rowtotal is greater than 2940, the score is 0
                    rowscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and pullups in worksheet f_pull
                    rowscore = Application.WorksheetFunction.VLookup(rowtime, Worksheets("f_row_alt").Range("A2:AJ483"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("f_row_alt").Range("B1:AJ1"), 0), False)
                End If
                
            End If
            ' Display the score in cell AC
            Range("AC" & rowNum).Value = rowscore
    End If
End If

'MUF and MTC
If Range("D4").Value = "NO" Then 'Check D4 for  NO --> Altitude Check
    If gender = "m" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("T" & rowNum).Value) Then
            ' MALE -- MTC -- NO ALTITUDE

                
                If mtctime < 240 Then 'if runtime is less than 240, the score is 100
                    mtcscore = 100
                ElseIf mtctime > 507 Then 'if runtime is greater than 507, the score is 0
                    mtcscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and runtime in worksheet m_run_noalt
                    mtcscore = Application.WorksheetFunction.VLookup(mtctime, Worksheets("m_mtc_noalt").Range("A2:AJ154"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("m_mtc_noalt").Range("B1:AJ1"), 0), False)
                End If
                Range("AD" & rowNum).Value = mtcscore

            ' FEMALE -- MTC -- NO ALTITUDE
            ' Check if gender is "f", age in H9 is numeric and runtime in Q9 is numeric
    ElseIf gender = "f" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("T" & rowNum).Value) Then
                   
                If mtctime < 319 Then 'if runtime is less than 319, the score is 100
                    mtcscore = 100
                ElseIf mtctime > 552 Then 'if runtime is greater than 522, the score is 0
                    mtcscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and runtime in worksheet f_run_noalt
                    mtcscore = Application.WorksheetFunction.VLookup(mtctime, Worksheets("f_mtc_noalt").Range("A2:AJ167"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("f_mtc_noalt").Range("B1:AJ1"), 0), False)
                End If
                Range("AD" & rowNum).Value = mtcscore
    End If



    If gender = "m" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("V" & rowNum).Value) Then
                
            ' MALE -- MUF -- NO ALTITUDE

                
                If muftime < 207 Then 'if runtime is less than 207, the score is 100
                    mufscore = 100
                ElseIf muftime > 609 Then 'if runtime is greater than 609, the score is 0
                    mufscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and runtime in worksheet m_run_noalt
                    mufscore = Application.WorksheetFunction.VLookup(muftime, Worksheets("m_muf_noalt").Range("A2:AJ243"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("m_muf_noalt").Range("B1:AJ1"), 0), False)
                End If
                Range("AF" & rowNum).Value = mufscore

            ' FEMALE -- MUF -- NO ALTITUDE
            ' Check if gender is "f", age in H9 is numeric and runtime in Q9 is numeric
    ElseIf gender = "f" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("V" & rowNum).Value) Then
                   
                If muftime < 255 Then 'if runtime is less than 255, the score is 100
                    mufscore = 100
                ElseIf muftime > 633 Then 'if runtime is greater than 633, the score is 0
                    mufscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and runtime in worksheet f_run_noalt
                    mufscore = Application.WorksheetFunction.VLookup(muftime, Worksheets("f_muf_noalt").Range("A2:AJ237"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("f_muf_noalt").Range("B1:AJ1"), 0), False)
                End If
                Range("AF" & rowNum).Value = mufscore
    End If




ElseIf Range("D4").Value = "YES" Then ' Altitutde Check for YES MTC & MUF
 
     If gender = "m" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("T" & rowNum).Value) Then
                
            ' MALE -- MTC -- ALTITUDE
                
                If mtctime < 246 Then 'if mtctime is less than 246, the score is 100
                    mtcscore = 100
                ElseIf mtctime > 511 Then 'if mtctime is greater than 511, the score is 0
                    mtcscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and mtctime in worksheet m_run_noalt
                    mtcscore = Application.WorksheetFunction.VLookup(mtctime, Worksheets("m_mtc_alt").Range("A2:AJ152"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("m_mtc_alt").Range("B1:AJ1"), 0), False)
                End If
                Range("AD" & rowNum).Value = mtcscore

            ' FEMALE -- MTC -- ALTITUDE
            ' Check if gender is "f", age in H9 is numeric and runtime in Q9 is numeric
    ElseIf gender = "f" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("T" & rowNum).Value) Then

                   
                If mtctime < 325 Then 'if runtime is less than 325, the score is 100
                    mtcscore = 100
                ElseIf mtctime > 558 Then 'if runtime is greater than 558, the score is 0
                    mtcscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and runtime in worksheet f_run_noalt
                    mtcscore = Application.WorksheetFunction.VLookup(mtctime, Worksheets("f_mtc_alt").Range("A2:AJ165"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("f_mtc_alt").Range("B1:AJ1"), 0), False)
                End If
                Range("AD" & rowNum).Value = mtcscore
    End If

    If gender = "m" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("V" & rowNum).Value) Then
                
            ' MALE -- MUF --  ALTITUDE
                
                If muftime < 215 Then 'if muftime is less than 215, the score is 100
                    mufscore = 100
                ElseIf muftime > 617 Then 'if muftime is greater than 617, the score is 0
                    mufscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and runtime in worksheet m_run_noalt
                    mufscore = Application.WorksheetFunction.VLookup(muftime, Worksheets("m_muf_alt").Range("A2:AJ243"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("m_muf_alt").Range("B1:AJ1"), 0), False)
                End If
                Range("AF" & rowNum).Value = mufscore

            ' FEMALE -- MUF -- ALTITUDE
            ' Check if gender is "f", age in H9 is numeric and runtime in Q9 is numeric
    ElseIf gender = "f" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("V" & rowNum).Value) Then

                   
                If muftime < 303 Then 'if muftime is less than 303, the score is 100
                    mufscore = 100
                ElseIf muftime > 641 Then 'if muftime is greater than 641, the score is 0
                    mufscore = 0
                Else 'otherwise, use lookup table to find the score
                    ' Find the score based on the values of age and runtime in worksheet f_run_noalt
                    mufscore = Application.WorksheetFunction.VLookup(muftime, Worksheets("f_muf_alt").Range("A2:AJ238"), _
                        Application.WorksheetFunction.Match(CLng(age), Worksheets("f_muf_alt").Range("B1:AJ1"), 0), False)
                End If
                Range("AF" & rowNum).Value = mufscore
    End If


End If

'Find the ACL score

    If gender = "m" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("U" & rowNum).Value) Then

        acl = Range("U" & rowNum).Value ' Get the value of acl from cell U
            
        If acl < 16 Then 'if acl are less than 16, score is 0
            aclscore = 0
        ElseIf acl > 120 Then 'if acl are more than 120, score is 100
            aclscore = 100
        Else 'otherwise, use lookup table to find the score
            ' Find the score based on the values of age and acl in worksheet m_pull
            aclscore = Application.WorksheetFunction.VLookup(acl, Worksheets("m_acl").Range("A2:AJ106"), _
                Application.WorksheetFunction.Match(CLng(age), Worksheets("m_acl").Range("B1:AJ1"), 0), False)
        Range("AE" & rowNum).Value = aclscore
        End If
        
    ' Check if gender is "f", age in H9 is numeric and acl in U is numeric
    ElseIf gender = "f" And IsNumeric(Range("H" & rowNum).Value) And IsNumeric(Range("U" & rowNum).Value) Then

        acl = Range("U" & rowNum).Value ' Get the value of acl from cell U
            
        If acl < 2 Then 'if acl are less than 2, score is 0
            aclscore = 0
        ElseIf acl > 75 Then 'if acl are more than 12, score is 100
            aclscore = 100
        Else 'otherwise, use lookup table to find the score
            ' Find the score based on the values of age and acl in worksheet f_pull
            aclscore = Application.WorksheetFunction.VLookup(acl, Worksheets("f_acl").Range("A2:AJ71"), _
                Application.WorksheetFunction.Match(CLng(age), Worksheets("f_acl").Range("B1:AJ1"), 0), False)
        End If
    Range("AE" & rowNum).Value = aclscore
    End If

End Sub
